<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/JSXTransformer.js"></script>
  <meta name="description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}">
  <link href='http://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="{{ "/css/main.css" | prepend: site.baseurl }}">
  <link rel="canonical" href="{{ page.url | replace:'index.html','' | prepend: site.baseurl | prepend: site.url }}">
</head>
<script type="text/jsx">
		var Preiskalkulator = React.createClass({
			getInitialState: function() {
				return {
					preisTotal: 0
				}
			},
			addTotal: function(preis) {
				this.setState({
					preisTotal: this.state.preisTotal + preis
				});
			},
			render: function() {
				var self = this;
				var getLeistungen = this.props.leistungen.map(function(l){
					return <Leistung name={l.name} preis={l.preis} active={l.active} addTotal={self.addTotal} def={l.def} />
				});
				return (
				<div className="preiskalkulator-wrapper">
					{getLeistungen}
					<hr />
					<div className="preis-total">Total: {this.state.preisTotal} EUR</div>
				</div>
				)
			}

		});
		var def = false;
		var Leistung = React.createClass({
			getInitialState: function() {
				return {
					active: false,
					def: false
				}
			},
			ClickHandler: function(e) {
				var active = !this.state.active;
				console.log(active);
				if(this.props.name === "Defektkorrektur I" || this.props.name === "Defektkorrektur II") {
					if(def && !active) {
						def=false;
						this.setState({
							active: active
						});
						this.props.addTotal(active? this.props.preis:-this.props.preis);
					} 
					if(def && active) {
						alert("Du brauchst nur eine der beiden Defektkorrekturen ausw√§hlen");
					}
					if(!def && active) {
						def=true;
						this.setState({
							active: active
						});
						this.props.addTotal(active? this.props.preis:-this.props.preis);
					}
				} else {
					this.setState({
						active: active
					});
					this.props.addTotal(active? this.props.preis:-this.props.preis);
				}
			},
			render: function() {
				return(
					<div className={this.state.active ? 'active preis' : 'preis'} onClick={this.ClickHandler}>
						{this.props.name}
						<strong>{this.props.preis} EUR</strong>
					</div>
				)
			}

		});

		var preise = [
			{name: "Polieren I (wenig Kratzer)", preis: 280, def: true},
			{name: "Polieren II (viele Kratzer)", preis: 400, def: true},
			{name: "Innenraum inkl. Lederpflege", preis: 140},
			{name: "Motorraum", preis: 60},
			{name: "Scheibenversiegelung", preis: 40},
			{name: "Felgenversiegelung", preis: 80},
			{name: "Gtechniq Crystal Serum", preis: 180},
			{name: "Gtechniq Exo", preis: 40}
		]
		React.render(
			<Preiskalkulator leistungen={preise} />,
			document.querySelector("#preiskalkulator")
		);
	</script>